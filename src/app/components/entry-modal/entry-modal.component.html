<div class="modal-backdrop" *ngIf="isOpen">
  <div class="modal">
    <header class="modal-header">
      <div>
        <h2>{{ entryToEdit ? 'Editar lançamento' : 'Novo lançamento' }}</h2>
        <p class="muted">Registre entradas, saídas, recorrências e parcelamentos.</p>
      </div>
      <button class="icon-button" type="button" (click)="onClose()">×</button>
    </header>

    <form class="modal-form" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <label class="full-width">
          Título do lançamento
          <input type="text" placeholder="Ex: Salário, Mercado" [(ngModel)]="form.title" name="title" />
        </label>

        <label>
          Categoria
          <input type="text" placeholder="Ex: Receitas, Mercado" [(ngModel)]="form.category" name="category" />
        </label>

        <label>
          Data do lançamento
          <input type="date" [(ngModel)]="form.date" name="date" />
        </label>

        <label>
          Valor do lançamento
          <input
            type="text"
            inputmode="decimal"
            placeholder="R$ 0,00"
            [(ngModel)]="form.amount"
            name="amount"
            (blur)="formatAmountOnBlur()"
          />
        </label>

        <label>
          Tipo de lançamento
          <select [(ngModel)]="form.type" name="type">
            <option value="entrada">Entrada</option>
            <option value="saida">Saída</option>
          </select>
        </label>
      </div>

      <div class="form-grid">
        <label>
          Meio de pagamento
          <select [(ngModel)]="form.paymentMethod" name="paymentMethod" (ngModelChange)="onPaymentMethodChange()">
            <option value="debito">Débito</option>
            <option value="pix">Pix</option>
            <option value="credito">Crédito</option>
          </select>
        </label>

        <label>
          Cartão
          <select [(ngModel)]="form.cardId" name="cardId" [disabled]="form.paymentMethod !== 'credito'">
            <option [ngValue]="''">Selecione um cartão</option>
            <option *ngFor="let card of cards" [value]="card.id">{{ card.name }}</option>
          </select>
        </label>

        <label>
          Recorrência
          <select [(ngModel)]="form.recurrence" name="recurrence">
            <option value="nenhuma">Não recorrente</option>
            <option value="semanal">Semanal</option>
            <option value="mensal">Mensal</option>
            <option value="anual">Anual</option>
          </select>
        </label>
      </div>

      <div class="installment-block">
        <label class="checkbox">
          <input
            type="checkbox"
            [(ngModel)]="form.isInstallment"
            name="isInstallment"
            [disabled]="form.paymentMethod !== 'credito'"
          />
          Compra parcelada (somente crédito)
        </label>

        <div class="installment-grid">
          <label>
            Parcela atual
            <input
              type="number"
              min="1"
              [(ngModel)]="form.installmentCurrent"
              name="installmentCurrent"
              [disabled]="!form.isInstallment"
            />
          </label>
          <label>
            Total de parcelas
            <input
              type="number"
              min="1"
              [(ngModel)]="form.installmentTotal"
              name="installmentTotal"
              [disabled]="!form.isInstallment"
            />
          </label>
        </div>
      </div>

      <div class="modal-actions">
        <button class="ghost" type="button" (click)="onClose()">Cancelar</button>
        <button class="primary" type="submit">
          {{ entryToEdit ? 'Salvar alterações' : 'Salvar lançamento' }}
        </button>
      </div>
    </form>
  </div>
</div>
