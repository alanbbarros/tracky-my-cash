<aside class="details">
  <div class="details-card">
    <h2>{{ selectedDayTitle }}</h2>

    <ng-container *ngIf="selectedDay; else monthOverview">
      <button class="primary full" type="button" (click)="openNewEntry.emit()">Novo lançamento</button>
      <div class="details-balance">
        <p>Saldo projetado no dia</p>
        <strong [class.negative]="selectedDay.balance < 0">
          {{ formatCurrency(selectedDay.balance) }}
        </strong>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Entradas do dia</span>
          <span class="value">
            {{ formatCurrency(selectedDay.income) }}
          </span>
        </div>
        <div>
          <span class="label">Saídas do dia</span>
          <span class="value negative">
            {{ formatCurrency(selectedDay.expenses) }}
          </span>
        </div>
      </div>
      <div class="transactions">
        <h3>Eventos relevantes</h3>
        <p *ngIf="selectedDay.transactions.length === 0" class="muted">
          Nenhum evento registrado para este dia.
        </p>
        <ul *ngIf="selectedDay.transactions.length">
          <li *ngFor="let transaction of selectedDay.transactions">
            <div>
              <p class="transaction-title">{{ transaction.title }}</p>
              <span class="muted">
                {{ transaction.category }} • {{ transaction.paymentMethod | uppercase }}
                <ng-container *ngIf="transaction.recurrence !== 'nenhuma'"> • recorrente</ng-container>
                <ng-container *ngIf="transaction.installment">
                  • {{ transaction.installment.current }}/{{ transaction.installment.total }}
                </ng-container>
              </span>
            </div>
            <div class="transaction-actions">
              <span [class.negative]="transaction.amount < 0">
                {{ formatCurrency(transaction.amount) }}
              </span>
              <button type="button" class="ghost" (click)="editTransaction.emit(transaction)">Editar</button>
              <button type="button" class="ghost" (click)="deleteTransaction.emit(transaction)">Excluir</button>
            </div>
          </li>
        </ul>
      </div>
      <button class="ghost full" type="button" (click)="openTransactions.emit(toFiltersForCycle())">
        Ver lançamentos do ciclo
      </button>
    </ng-container>

    <ng-template #monthOverview>
      <button class="primary full" type="button" (click)="openNewEntry.emit()">Novo lançamento</button>
      <div class="details-balance">
        <p>Saldo no início do ciclo</p>
        <strong [class.negative]="focusedMonth?.startBalance && focusedMonth.startBalance < 0">
          {{ focusedMonth ? formatCurrency(focusedMonth.startBalance) : '—' }}
        </strong>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Saldo final estimado</span>
          <span class="value" [class.negative]="focusedMonth?.endBalance && focusedMonth.endBalance < 0">
            {{ focusedMonth ? formatCurrency(focusedMonth.endBalance) : '—' }}
          </span>
        </div>
        <div>
          <span class="label">Período da fatura</span>
          <span class="value">
            {{ focusedMonth?.cycleStart | date: 'dd/MM' }} →
            {{ focusedMonth?.cycleEnd | date: 'dd/MM' }}
          </span>
        </div>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Entradas do ciclo</span>
          <span class="value">
            {{ focusedMonth ? formatCurrency(focusedMonth.incomeTotal) : '—' }}
          </span>
        </div>
        <div>
          <span class="label">Saídas do ciclo</span>
          <span class="value negative">
            {{ focusedMonth ? formatCurrency(focusedMonth.expensesTotal) : '—' }}
          </span>
        </div>
      </div>
      <button class="ghost full" type="button" (click)="openTransactions.emit(toFiltersForCycle())">
        Ver lançamentos do ciclo
      </button>
    </ng-template>
  </div>
</aside>
