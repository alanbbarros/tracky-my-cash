<aside class="details">
  <div class="details-card">
    <h2>{{ selectedDayTitle }}</h2>

    <ng-container *ngIf="selectedDay; else cycleOverview">
      <div class="details-balance">
        <p>Saldo projetado no dia</p>
        <strong [class.negative]="selectedDay.balance < 0">
          {{ formatCurrency(selectedDay.balance) }}
        </strong>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Entradas do dia</span>
          <span class="value">
            {{ formatCurrency(selectedDay.income) }}
          </span>
        </div>
        <div>
          <span class="label">Saídas do dia</span>
          <span class="value negative">
            {{ formatCurrency(selectedDay.expenses) }}
          </span>
        </div>
      </div>
      <div class="transactions">
        <h3>Lançamentos do dia</h3>
        <p *ngIf="selectedDay.transactions.length === 0" class="muted">
          Nenhum lançamento registrado para este dia.
        </p>
        <ul *ngIf="selectedDay.transactions.length">
          <li *ngFor="let transaction of selectedDay.transactions">
            <div class="transaction-main">
              <div>
                <p class="transaction-title">{{ transaction.title }}</p>
                <span class="muted">
                  {{ transaction.category }} • {{ transaction.paymentMethod | titlecase }}
                  <ng-container *ngIf="transaction.recurrence !== 'nenhuma'">• Recorrente</ng-container>
                  <ng-container *ngIf="formatInstallment(transaction)">• {{ formatInstallment(transaction) }}</ng-container>
                </span>
              </div>
              <span [class.negative]="transaction.amount < 0">
                {{ formatCurrency(transaction.amount) }}
              </span>
            </div>
            <div class="transaction-actions">
              <button class="ghost" type="button" (click)="editTransaction.emit(transaction)">Editar</button>
              <button class="ghost danger" type="button" (click)="deleteTransaction.emit(transaction)">Excluir</button>
            </div>
          </li>
        </ul>
      </div>
    </ng-container>

    <ng-template #cycleOverview>
      <div class="details-balance">
        <p>Saldo no início do ciclo</p>
        <strong [class.negative]="focusedCycle?.startBalance && focusedCycle.startBalance < 0">
          {{ focusedCycle ? formatCurrency(focusedCycle.startBalance) : '—' }}
        </strong>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Status da fatura</span>
          <span class="value">
            {{ cycleStatusLabel }}
          </span>
        </div>
        <div>
          <span class="label">Total no crédito</span>
          <span class="value negative">
            {{ focusedCycle ? formatCurrency(focusedCycle.creditTotal) : '—' }}
          </span>
        </div>
      </div>
      <div class="details-row">
        <div>
          <span class="label">Entradas do ciclo</span>
          <span class="value">
            {{ focusedCycle ? formatCurrency(focusedCycle.incomeTotal) : '—' }}
          </span>
        </div>
        <div>
          <span class="label">Saídas do ciclo</span>
          <span class="value negative">
            {{ focusedCycle ? formatCurrency(focusedCycle.expensesTotal) : '—' }}
          </span>
        </div>
      </div>
      <button class="ghost full" type="button" *ngIf="focusedCycle" (click)="viewCycleTransactions.emit()">
        Ver lançamentos da fatura
      </button>
    </ng-template>
  </div>
</aside>
