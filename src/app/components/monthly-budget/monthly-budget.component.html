<section class="budget">
  <header class="budget-header">
    <div>
      <p class="eyebrow">Orçamento da fatura</p>
      <h2>{{ cycle.label }}</h2>
      <p class="subtitle">
        {{ cycle.cycleRangeLabel }} • vencimento em {{ cycle.dueDateLabel }}
      </p>
    </div>
    <div class="actions">
      <button class="ghost" type="button">Editar categorias</button>
      <button class="primary" type="button" (click)="closeBudget.emit()">Voltar ao calendário</button>
    </div>
  </header>

  <div class="budget-overview">
    <article class="overview-card">
      <span class="label">Planejado na fatura</span>
      <strong>{{ formatCurrency(totalPlanned()) }}</strong>
    </article>
    <article class="overview-card">
      <span class="label">Comprometido</span>
      <strong>{{ formatCurrency(totalCommitted()) }}</strong>
    </article>
    <article class="overview-card">
      <span class="label">Disponível</span>
      <strong [class.negative]="totalRemaining() < 0">{{ formatCurrency(totalRemaining()) }}</strong>
    </article>
    <article class="overview-card usage">
      <span class="label">Uso do orçamento da fatura</span>
      <strong>{{ overallUsage() | number: '1.0-0' }}%</strong>
      <div class="progress">
        <span [style.width.%]="overallUsage()"></span>
      </div>
    </article>
  </div>

  <div class="budget-lines">
    <div class="lines-header">
      <h3>Consumo por categoria</h3>
      <span class="muted">Percentual usado em relação ao planejado</span>
    </div>
    <div class="line-item" *ngFor="let category of categories">
      <div class="line-info">
        <span class="name">{{ category.name }}</span>
        <span class="percentage">{{ percentUsed(category) | number: '1.0-0' }}%</span>
      </div>
      <div class="line-bar">
        <span [style.width.%]="percentUsed(category)"></span>
      </div>
      <div class="line-meta">
        <span>{{ formatCurrency(category.committed) }}</span>
        <span class="muted">de {{ formatCurrency(category.planned) }}</span>
      </div>
    </div>
  </div>

  <div class="budget-grid">
    <article class="budget-card" *ngFor="let category of categories">
      <div class="card-header">
        <h3>{{ category.name }}</h3>
        <span class="muted">Planejado</span>
      </div>
      <p class="planned">{{ formatCurrency(category.planned) }}</p>
      <div class="card-progress">
        <span [style.width.%]="percentUsed(category)"></span>
      </div>
      <div class="budget-row">
        <span class="label">Comprometido</span>
        <span>{{ formatCurrency(category.committed) }}</span>
      </div>
      <div class="budget-row">
        <span class="label">Disponível</span>
        <span [class.negative]="remaining(category) < 0">
          {{ formatCurrency(remaining(category)) }}
        </span>
      </div>
    </article>
  </div>
</section>
