<div class="app-shell">
  <app-top-bar
    [focusedCycle]="focusedCycle"
    [canNavigatePrevious]="canNavigatePrevious"
    [canNavigateNext]="canNavigateNext"
    [activeView]="activeView"
    (navigatePrevious)="onPreviousCycle()"
    (navigateNext)="onNextCycle()"
    (openNewEntry)="openModal()"
    (viewChange)="onViewChange($event)"
  ></app-top-bar>

  <main class="content" *ngIf="activeView === 'calendar'">
    <app-calendar-section
      [focusedCycle]="focusedCycle"
      [selectedDay]="selectedDay"
      (daySelect)="onSelectDay($event)"
      (openInvoice)="openInvoiceView()"
    ></app-calendar-section>

    <app-details-panel
      [selectedDay]="selectedDay"
      [focusedCycle]="focusedCycle"
      (editTransaction)="openModal($event)"
      (deleteTransaction)="onDeleteTransaction($event)"
      (viewCycleTransactions)="viewCycleTransactions()"
    ></app-details-panel>
  </main>

  <app-cards-section
    *ngIf="activeView === 'cards'"
    [cards]="cards"
    [cycleSummaries]="cardSummaries"
    (saveCard)="onSaveCard($event)"
    (updateCard)="onUpdateCard($event)"
    (viewCurrentInvoice)="viewCardInvoice($event)"
  ></app-cards-section>

  <app-transactions-section
    *ngIf="activeView === 'transactions'"
    [transactions]="transactions"
    [cards]="cards"
    [presetFilters]="transactionFilters"
    (editTransaction)="openModal($event)"
    (deleteTransaction)="onDeleteTransaction($event)"
  ></app-transactions-section>

  <app-invoice-detail
    *ngIf="activeView === 'invoice'"
    [card]="activeCard"
    [cycle]="focusedCycle"
    [transactions]="transactions"
    (editTransaction)="openModal($event)"
    (markAsPaid)="onMarkInvoicePaid()"
  ></app-invoice-detail>

  <app-entry-modal
    [isOpen]="isModalOpen"
    [cards]="cards"
    [transactionToEdit]="editingTransaction"
    (closeModal)="closeModal()"
    (saveEntry)="onSaveEntry($event)"
    (updateEntry)="onUpdateEntry($event)"
  ></app-entry-modal>
</div>
