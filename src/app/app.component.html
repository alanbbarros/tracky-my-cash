<div class="app-shell">
  <header class="top-bar">
    <div>
      <p class="eyebrow">Tracky My Cash</p>
      <h1>Visão de saldo estimado</h1>
      <p class="subtitle">
        Acompanhe seu orçamento pessoal, lançamentos recorrentes e gastos pontuais com um calendário de 20 meses.
      </p>
    </div>
    <div class="actions">
      <button class="ghost">Configurar categorias</button>
      <button class="primary" (click)="openModal()">Novo lançamento</button>
    </div>
  </header>

  <section class="summary">
    <article class="summary-card">
      <h3>Saldo projetado hoje</h3>
      <p class="summary-value">
        {{ selectedDay ? formatCurrency(selectedDay.balance) : '—' }}
      </p>
      <p class="summary-meta">Baseado nos lançamentos cadastrados.</p>
    </article>
    <article class="summary-card">
      <h3>Receitas recorrentes</h3>
      <p class="summary-value">{{ formatCurrency(6200) }}</p>
      <p class="summary-meta">Salário, freelas e outras entradas.</p>
    </article>
    <article class="summary-card">
      <h3>Despesas fixas</h3>
      <p class="summary-value negative">{{ formatCurrency(-310) }}</p>
      <p class="summary-meta">Assinaturas, academia, serviços.</p>
    </article>
  </section>

  <main class="content">
    <section class="calendar">
      <header class="calendar-header">
        <h2>Calendário de projeção</h2>
        <p>Passe o mouse sobre um dia para ver detalhes do saldo estimado.</p>
      </header>

      <div class="month-grid">
        <article class="month" *ngFor="let month of months">
          <div class="month-title">
            <span>{{ month.label }}</span>
            <span class="muted">{{ month.year }}</span>
          </div>
          <div class="weekday-row">
            <span>Seg</span>
            <span>Ter</span>
            <span>Qua</span>
            <span>Qui</span>
            <span>Sex</span>
            <span>Sáb</span>
            <span>Dom</span>
          </div>
          <div class="days-grid">
            <ng-container *ngFor="let cell of month.cells">
              <div
                class="day"
                [class.placeholder]="cell.isPlaceholder"
                [class.today]="cell.day?.isToday"
                (mouseenter)="cell.day ? onHoverDay(cell.day) : null"
              >
                <ng-container *ngIf="cell.day">
                  <span class="day-number">{{ cell.day.date.getDate() }}</span>
                  <div class="day-notifications" *ngIf="cell.day.incomeCount || cell.day.expenseCount">
                    <span class="notification income" *ngIf="cell.day.incomeCount">
                      +{{ cell.day.incomeCount }}
                    </span>
                    <span class="notification expense" *ngIf="cell.day.expenseCount">
                      +{{ cell.day.expenseCount }}
                    </span>
                  </div>
                  <span class="day-balance" [class.negative]="cell.day.balance < 0">
                    {{ formatCurrency(cell.day.balance) }}
                  </span>
                </ng-container>
              </div>
            </ng-container>
          </div>
        </article>
      </div>
    </section>

    <aside class="details">
      <div class="details-card">
        <h2>{{ selectedDayTitle }}</h2>
        <div class="details-balance">
          <p>Saldo estimado</p>
          <strong [class.negative]="selectedDay?.balance && selectedDay.balance < 0">
            {{ selectedDay ? formatCurrency(selectedDay.balance) : '—' }}
          </strong>
        </div>
        <div class="details-row">
          <div>
            <span class="label">Entradas</span>
            <span class="value">
              {{ selectedDay ? formatCurrency(selectedDay.income) : '—' }}
            </span>
          </div>
          <div>
            <span class="label">Saídas</span>
            <span class="value negative">
              {{ selectedDay ? formatCurrency(selectedDay.expenses) : '—' }}
            </span>
          </div>
        </div>
        <div class="transactions">
          <h3>Lançamentos do dia</h3>
          <p *ngIf="!selectedDay || selectedDay.transactions.length === 0" class="muted">
            Nenhum lançamento registrado para este dia.
          </p>
          <ul *ngIf="selectedDay && selectedDay.transactions.length">
            <li *ngFor="let transaction of selectedDay.transactions">
              <div>
                <p class="transaction-title">{{ transaction.title }}</p>
                <span class="muted">{{ transaction.category }}</span>
              </div>
              <span [class.negative]="transaction.amount < 0">
                {{ formatCurrency(transaction.amount) }}
              </span>
            </li>
          </ul>
        </div>
        <div class="insights">
          <h3>Insights rápidos</h3>
          <ul>
            <li>Projeção considera lançamentos esporádicos e recorrentes.</li>
            <li>Integração futura com app mobile e automações via atalho.</li>
            <li>Orçamento por categoria em desenvolvimento.</li>
          </ul>
        </div>
      </div>
    </aside>
  </main>

  <div class="modal-backdrop" *ngIf="isModalOpen">
    <div class="modal">
      <header class="modal-header">
        <div>
          <h2>Novo lançamento</h2>
          <p class="muted">Registre entradas, saídas e recorrências.</p>
        </div>
        <button class="icon-button" type="button" (click)="closeModal()">×</button>
      </header>

      <form class="modal-form">
        <label>
          Valor do lançamento
          <input type="number" placeholder="R$ 0,00" [(ngModel)]="newEntry.amount" name="amount" />
        </label>

        <label>
          Tipo de lançamento
          <select [(ngModel)]="newEntry.type" name="type">
            <option value="entrada">Entrada</option>
            <option value="saida">Saída</option>
          </select>
        </label>

        <label>
          Data do lançamento
          <input type="date" [(ngModel)]="newEntry.date" name="date" />
        </label>

        <label>
          Recorrência
          <select [(ngModel)]="newEntry.recurrence" name="recurrence">
            <option value="mensal">Mensal</option>
            <option value="quinzenal">Quinzenal</option>
            <option value="semanal">Semanal</option>
            <option value="trimestral">Trimestral</option>
          </select>
        </label>

        <div class="modal-actions">
          <button class="ghost" type="button" (click)="closeModal()">Cancelar</button>
          <button class="primary" type="button">Salvar lançamento</button>
        </div>
      </form>
    </div>
  </div>
</div>
